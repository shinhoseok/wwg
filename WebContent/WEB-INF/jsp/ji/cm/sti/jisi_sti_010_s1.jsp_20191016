<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /* 프로그램 이름     : main2    /* 소스파일 이름     : main2.jsp/* 설명              : SYSTEM 통계관리 일별통계 메인페이지/* 버전              : 1.0.0/* 최초 작성자       : 이금용/* 최초 작성일자     : 2014-02-25/* 최근 수정자       : 이금용/* 최근 수정일시     : 2014-02-25/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><script type="text/javascript">$(document).ready(function(){		//현재 날짜 기본설정	$("#start_ymd").val("<%=DateUtility.getaddmon(curDate,"-", 1).substring(0,4)+"-"+DateUtility.getaddmon(curDate,"-", 1).substring(4,6)+"-"+DateUtility.getaddmon(curDate,"-", 1).substring(6,8)%>");	// 한달 전 데이타 설정	$("#end_ymd").val("<%=curDate.substring(0,4)+"-"+curDate.substring(4,6)+"-"+ curDate.substring(6,8)%>");		chart();		$("#btn_search").click( function() {		var start_ymd = $("#start_ymd").val();		var end_ymd = $("#end_ymd").val();		var checkdate = addDate("m",1,start_ymd,"-"); 		if(parseInt(start_ymd.replace(/-/g,"")) > parseInt(end_ymd.replace(/-/g,""))){			alert('종료일이 시작일보다 이전일수 없습니다.');			return;		}		if(parseInt(end_ymd.replace(/-/g,"")) > parseInt(checkdate.replace(/-/g,""))){			alert('조회 기간은 한달 이내에만 가능합니다.');			return;		}		chart();		refreshGrid(); //조회		refreshGrid1(); //조회	});    		var cols =[	           	 {label:'번호'       ,index:'row_seq'   ,name:'row_seq'   ,align:'center' 	,width:'50'	  ,hidden:false  ,sortable:true}	           	,{label:'접속일'    ,name:'name'        ,index:'name'     ,align:'center'  ,width:'100'  ,hidden:false  ,sortable:false}	           	,{label:'접속건수'  ,name:'line1'       ,index:'line1'    ,align:'center'  ,width:'100'  ,hidden:false  ,sortable:false}		      ];		//init grid	var grid = com.grid.init({		id			: '#jqGrid'		,viewrecords: true		,multiselect: true		,height		: 452		,autowidth  : true		,rowNum		: 15		,gridComplete: function(){			mergeCellcomplet($(this));		}		,onSelectRow: function(id) { // row를 선택했을때 액션.					}		,custom : { //custom			 cols : cols //컬럼정보 - 필수!			,navButton : {				excel : {					exportName	: $('.con_title>h3').text().trim() //엑셀다운로드시 사용할 파일명				}			}		}	});	refreshGrid(); //조회		var cols1 =[	          	 {label:'번호'       ,index:'row_seq'   ,name:'row_seq'   ,align:'center'   ,width:'50'	  ,hidden:false  ,sortable:true}	          	,{label:'요일'    	  ,name:'name'       ,index:'name'     ,align:'center'  ,width:'100'  ,hidden:false  ,sortable:false}	          	,{label:'접속건수'   ,name:'line1'      ,index:'line1'    ,align:'center'  ,width:'100'  ,hidden:false  ,sortable:false}		       ];		//init grid	var grid1 = com.grid.init({		id			: '#jqGrid1'		,viewrecords: true		,multiselect: true		,height		: 242		,autowidth  : true		,rowNum		: 15		,gridComplete: function(){		 mergeCellcomplet($(this));		}		,onSelectRow: function(id) { // row를 선택했을때 액션.		}		,custom : { //custom			cols : cols //컬럼정보 - 필수!			,navButton : {				excel : {					exportName	: $('.con_title>h3').text().trim() //엑셀다운로드시 사용할 파일명				}			}		}	});	refreshGrid1(); //조회		$('#tab_2').hide();		$("#btn_excel").click(function(e){		//엑셀출력[화면,전체] - 파라미터(그리드명,엑셀구분[화면:"",전체:""],엑셀명)		excelDownload("jqGrid", "", "<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("> ")+1)%> 화면리스트", "<c:url value='/cmsmain.do'/>");		});		$("#btn_excelAll").click(function(e){				//엑셀출력[화면,전체] - 파라미터(그리드명,엑셀구분[화면:"",전체:"A"],엑셀명) - java 리스트쪽 구현해야함		excelDownload("jqGrid", "A", "<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("> ")+1)%> 전체리스트", "<c:url value='/cmsmain.do'/>");		});			$("#btn_excel1").click(function(e){			//엑셀출력[화면,전체] - 파라미터(그리드명,엑셀구분[화면:"",전체:""],엑셀명)		excelDownload("jqGrid1","","<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("> ")+1)%> 화면리스트", "<c:url value='/cmsmain.do'/>");			});		$("#btn_excelAll1").click(function(e){				//엑셀출력[화면,전체] - 파라미터(그리드명,엑셀구분[화면:"",전체:"A"],엑셀명) - java 리스트쪽 구현해야함		excelDownload("jqGrid1","A","<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("> ")+1)%> 전체리스트", "<c:url value='/cmsmain.do'/>");		});			$("#li_1").click( function() {		$('#li_1').attr('class','selected');		$('#li_2').attr('class','');		$('#tab_1').fadeIn(700);		$('#tab_2').hide();	});	//작업계획 tab 클릭시	$("#li_2").click( function() {		$('#li_1').attr('class','');		$('#li_2').attr('class','selected');		$('#tab_1').hide();		$('#tab_2').fadeIn(700);	});});function refreshGrid(){	var _frm = document.listfrm;	_frm.action='<%=RequestURL%>';	var params = com.frm.getParamJSON(document.listfrm);	params.pstate = 'X1';	com.grid.reload('#jqGrid','<c:url value='/cmsajax.do' />',params);}function refreshGrid1(){	var _frm = document.listfrm;	_frm.action='<%=RequestURL%>';	var params = com.frm.getParamJSON(document.listfrm);	params.pstate = 'X2';	com.grid.reload('#jqGrid1','<c:url value='/cmsajax.do' />',params);}function refreshChart(){	ParamDatas();}//그리드 조회시 요청할 파라미터 objectfunction ParamDatas(){	var _params = com.frm.getParamJSON(document.listfrm);	return _params;}function chart(){	$("#chart1").empty();	$("#chart2").empty();	var horibarchart = new Array();	var barchart = new Array();	var params = ParamDatas();	params.pstate = 'X';	 $.ajax({         type: "post",         url: "<c:url value='/cmsajax.do' />",         data: params,         async: false,         dataType:"json",         success: function(data){         	 if(data.result==false){         		$("#chart1").empty();         		$("#chart2").empty();         		 alert('데이터가 존재하지 않습니다');         	 }else{         		horibarchart  = data.horichart.horizonbarchart;         		barchart  = data.barchart.barchart;          		if(horibarchart.length > 0){         			$("#chart1").height(horibarchart.length*40);         		}         			            	$.jqplot.config.enablePlugins = true;         				//console.log(horibarchart)	            	    var plot1 = $.jqplot('chart1', [horibarchart], {	            	        // Only animate if we're not using excanvas (not in IE 7 or IE 8)..	            	        animate: true, 	            	        seriesDefaults:{	            	            renderer:$.jqplot.BarRenderer,	            	            pointLabels : {show:true ,location:'e', edgeTolerance:-15},	            	            shadowAngel :135,	            	            rendererOptions: {	            	                barDirection:'horizontal'	            	                //fillToZero:true	            	                //barMargin:30	            	            }	            	        },	            	        axesDefaults : {	            	        	tickRenderer : $.jqplot.CanvasAxisTickRenderer,	            	        	tickOptions:{	            	        		//angel : -100,	            	        		fontsize : '10pt'	            	        	}	            	        },	            	        axes:{	            	            yaxis:{	            	                renderer: $.jqplot.CategoryAxisRenderer	            	                //pad : 1000	            	                	            	            }	            	            ,xaxis:{	            	            	//renderer: $.jqplot.CategoryAxisRenderer	            	                //pad : 1000	            	                	            	            }	            	        },			    	        highlighter: {					            show: false					            //showLabel: true,					            //tooltipAxes: 'y'	// 그래프 상단에 보여지게 Y축을 기준으로 보여지게 하는 것					            //sizeAdjust: 7.5, 					            //tooltipLocation : 'ne'				            }	            	        	            	    });	            	    	            	    //$(".jqplot-target").height($(".jqplot-target").height()+30);	            	    $("#chart1").height($("#chart1").height()+30);	            	    //$(".jqplot-axis").height(30);	            	    	            	    	            	    	            	    //console.log(barchart);	            	    var plot2 = $.jqplot('chart2', [barchart], {	            	        // Only animate if we're not using excanvas (not in IE 7 or IE 8)..	            	        //title: '요일별 통계리스트',	            	        animate: true,	            	        seriesDefaults:{	            	            renderer:$.jqplot.BarRenderer,	            	            rendererOptions: {	            	                varyBarColor: true	            	            }	            	        },	            	        axesDefaults : {	            	        	tickRenderer : $.jqplot.CanvasAxisTickRenderer,	            	        	tickOptions:{	            	        		//angel : -100,	            	        		fontsize : '10pt'	            	        			            	        	}	            	        		            	        },	            	        axes:{	            	            xaxis:{	            	                renderer: $.jqplot.CategoryAxisRenderer	            	            }	            	        	            	        },			    	        highlighter: {					            show: false					            //showLabel: true,					            //tooltipAxes: 'y'	// 그래프 상단에 보여지게 Y축을 기준으로 보여지게 하는 것					            //sizeAdjust: 7.5, 					            //tooltipLocation : 'ne'				            }	            	    });	            	    //console.log('11111111');	            	    $("#chart2").height($("#chart2").height()+30);	            	    //$("#chart2").find(".jqplot-axis").height(30);		            	    $(".jqplot-axis").height(30);	            	    	             }//else         	          	}//success  	});}		function getMonthsBetweenPeriodi(fromYm, endYm) {	var fromYear, fromMonth, toYear, toMonth;	var diff_mon=0;	var diff_year=0;	fromYear = parseInt(fromYm.substring(0,4));	fromMonth= parseInt(fromYm.substring(4,6));	toYear = parseInt(endYm.substring(0,4));	toMonth= parseInt(endYm.substring(4,6));	// 년도의 차이를 구한다	diff_year = toYear-fromYear;	// 년도가 다르면 개월수는 달라진다	if(diff_year > 0){		// 먼저 시작년도의 월수를 구한다		diff_mon = 12-fromMonth+1;		// 년도의 차이만큼 개월수를 더한다		diff_mon = diff_mon + (12*(diff_year));		// 마지막년도의 남은월을 빼준다		diff_mon = diff_mon - (12-toMonth);			}else{		diff_mon = toMonth-fromMonth+1;	}		return diff_mon;}</script>					<form name="listfrm" id="listfrm" method="post" onSubmit='return false;Go_search();' >        <input type="hidden" name="scode" id="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" id="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" id="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" id="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" id="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="sidx" value="" title="선택된인덱스" />   <div class="section" style="position:relative;"> 		<!-- tab -->		<ul class="tab_menu">			<li id="li_1" class="selected"><a href="#">차트보기</a></li>			<li id="li_2" class=""><a href="#">리스트보기</a></li>		</ul>		<!-- tab //--> 	</div>	<div class="searchArea mT10 ">  <table class="tbl_search">    <colgroup>    <col width="30" />    <col width="*" />    <col width="50" />    <col width="*" />    </colgroup>    <tr>        <th scope="row">조회기간</th>        <td>			<input type="text" name="start_ymd" id="start_ymd" value="" size="12" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();" title="팝업존시작일 입력" />			<span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('start_ymd'));return false;"></a></span>			<span class="clear"> ~&nbsp;</span> 			<input type="text" name="end_ymd" id="end_ymd" value="" size="12" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();" title="팝업존시작일 입력" />			<span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('end_ymd'));return false;"></a></span>        </td>	    <td colspan="2" class="aR"> 			<span class="btn_pack largeO"><a href="#" id="btn_search">검색</a></span>    		</td>	</tr>  </table></div>   <!-- end of search --> <div id="tab_1" class="">	<h3><span>&#8226;</span>일별 통계 리스트</h3>    <div id="chart1" style="height:1500px;width:92%"></div> 	<h3><span>&#8226;</span>요일별 통계 리스트</h3>    <div id="chart2" style="height:400px;width:92%"></div> </div>  <div id="tab_2" class="">    <div class="section mT10">	      <h3 class="fL"><span>&#8226;</span>일별통계 통계 리스트</h3>	      <p class="fR">	           <span class="btn_pack medium icon" id="btn_excel" ><span class="excel"></span><a href="# none;" >화면출력</a></span>	           <span class="btn_pack medium icon" id="btn_excelAll" ><span class="excel"></span><a href="# none;" >전체출력</a></span>	      </p>    </div>    <table id='jqGrid'></table>        <div class="section mT10">	      <h3 class="fL"><span>&#8226;</span>요일별 통계 리스트</h3>	      <p class="fR">	           <span class="btn_pack medium icon" id="btn_excel1" ><span class="excel"></span><a href="# none;" >화면출력</a></span>	           <span class="btn_pack medium icon" id="btn_excelAll1" ><span class="excel"></span><a href="# none;" >전체출력</a></span>	      </p>    </div>    <table id='jqGrid1'></table>     </div>   </form>					