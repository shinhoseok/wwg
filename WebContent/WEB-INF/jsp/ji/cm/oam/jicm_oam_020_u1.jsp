<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /WEB-INF/jsp/cmsadmin/code_manager/list /* 프로그램 이름     : list  /* 소스파일 이름     : list.jsp/* 설명              : SYSTEM 코드관리 목록페이지/* 버전              : 1.0.0/* 최초 작성자       : 박창현/* 최초 작성일자     : 2014-02-05/* 최근 수정자       : 박창현/* 최근 수정일시     : 2014-02-05/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><script language="javascript" src="<%=con_root%>/js/com-tree.js"></script><script type="text/javascript">var searchYn = false;$(function(){	var cmtreeval = new Array();	//init tree	$.fn.cmtree({		 id			: '#cmtree_data' 		 ,treeAreaId : "#treeArea"		 ,treeMenuId : "#treeMenu"		 ,treeHeight : ($("#content").height()-40)+"px"		 ,treeWidth  : "200px"		 ,treemHeight : ($("#content").height()-80)+"px"		 ,treemWidth : "160px"	 		 ,checkBoxYn: false		 ,treeArr   : cmtreeval		 ,onClickTitlefn: "treeClickTitle01"		 ,treeRelComboId : "org_select_group"		 ,treeRelComboboxId : "org_option"		 ,treeImgPath : "<%=img_url%>"	});		//목록 이동		$("#btn_list").click(function(e){			var selorg_option = "";			if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();			}else{				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();			}			$("input[name='sorg_cd']").val(selorg_option);						  su_form=document.cffrm;			  su_form.method='post';			  su_form.pstate.value='L';			  su_form.action='<%=RequestURL%>';			  su_form.submit();		});				//수정		$("#btn_modify").click(function(e){			if(!validation("cffrm")) return false; //필수 체크						// 비밀번호가 입력되어있을경우 비밀번호를 체크한다			if(!isEmpty($('input[name=login_ipns]').val()) ){				if($('input[name=login_ipns]').val().length < 9 || $('input[name=login_ipns]').val().length > 20){					alert("비밀번호는 영문,숫자,특수문자 조합으로 9~20자리로 사용해야합니다.");					document.getElementsByName("login_ipns")[0].focus();					return;				}								if(!$('input[name=login_ipns]').val().match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~,(,),+])|([!,@,#,$,%,^,&,*,?,_,~,(,),+].*[a-zA-Z0-9])/)){					alert("비밀번호는 영문,숫자,특수문자 조합으로 9~20자리로 사용해야합니다.");					document.getElementsByName("login_ipns")[0].focus();					return;				}							}						// 이메일주소 직접입력이면			if($("#user_email2").val()=='직접입력'){				if(!isEmpty($("#user_email1").val())){					if(isMail($("#user_email1").val())){						alert("이메일을 형식이 맞지않습니다.");						$("#user_email1").focus();							return;									}									}else{									}			// 이메일주소 선택입력이면			}else{				if(!isEmpty($("#user_email1").val())){					if(isMail($("#user_email1").val()+"@"+$("#user_email2").val())){						alert("이메일을 형식이 맞지않습니다.");						$("#user_email1").focus();							return;									}									}else{									}							}							// 핸드폰 번호가 입력되어있으면			if(!isEmpty($("#moblphon").val())){				if(!isHpFormat($("#moblphon").val())){					alert("핸드폰번호가 형식이 맞지않습니다.");					$("#moblphon").focus();						return;										}			}						var selorg_option = "";			if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();			}else{				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();			}			$("input[name='sorg_cd']").val(selorg_option);						$("#pstate").val("U");			var params = jQuery("#cffrm").serialize();			CmopenLoading();					 $.ajax({			             type: "post",			             url: "<c:url value='/cmsajax.do'/>",			             data: params,			             async: false,			             dataType:"json",			             timeout: 3000,			             error: function (jqXHR, textStatus, errorThrown) {			                 // 통신에 에러가 있을경우 처리할 내용(생략가능)			    	        	alert("네트웍장애가 발생했습니다. 다시시도해주세요");			    	        	CmcloseLoading();            			             },				             			             success: function(data){				               if(data.result==true){				                	alert('수정 되었습니다.');				                	reloadingUF();				               }else{				            	   	alert(data.TRS_MSG);				            	   	CmcloseLoading();				               }				               			             }			      });		});					//삭제		$("#btn_delete").click(function(e){			if(!confirm("삭제하시겠습니까?")){				return;			}							$("#pstate").val("D");			var params = jQuery("#cffrm").serialize();			CmopenLoading();					 $.ajax({			             type: "post",			             url: "<c:url value='/cmsajax.do'/>",			             data: params,			             async: false,			             dataType:"json",			             timeout: 3000,			             error: function (jqXHR, textStatus, errorThrown) {			                 // 통신에 에러가 있을경우 처리할 내용(생략가능)			    	        	alert("네트웍장애가 발생했습니다. 다시시도해주세요");			    	        	CmcloseLoading();            			             },				             			             success: function(data){				               if(data.result==true){				                	alert('삭제 되었습니다.');				                	$("#btn_list").trigger("click");				               }else{				            	   	alert(data.TRS_MSG);				            	   	CmcloseLoading();				               }				               			             }			      });		});					$("#user_email2").change( function() {			if($("#user_email2").val()=='직접입력'){							}else{							}		});										CmopenLoading();		refreshTree();//트리조회				// 조직 셀렉트 박스를 만든다		$.fn.cmtree.treeRelComboboxMake('','', 0);			<%		if(!HtmlTag.returnString((String)viewMap.get("org_cd"),"").equals("")){		%>		treeClickTitle01($.fn.cmtree.rtnTreeArr('<%=HtmlTag.returnString((String)viewMap.get("org_cd"),"")%>'));		<%		}				String [] user_mail = new String[2];				// 메일주소 셋팅		if(!HtmlTag.returnString((String)viewMap.get("email"),"").equals("")){			if(HtmlTag.returnString((String)viewMap.get("email"),"").indexOf("@") > -1){				user_mail = HtmlTag.returnString((String)viewMap.get("email"),"").split("@");			}else{				user_mail[0] = HtmlTag.returnString((String)viewMap.get("email"),"");				user_mail[1] = "komipo.co.kr";			}		}else{			user_mail[0] = "";			user_mail[1] = "komipo.co.kr";		}		%>		$("#user_email1").val("<%=user_mail[0]%>");		$("#user_email2").val("<%=user_mail[1]%>");		if($("#user_email2").val()==undefined){			$("#user_email1").val("<%=HtmlTag.returnString((String)viewMap.get("email"),"")%>");			$("#user_email2").val("직접입력");		}				$("#grd_cd").val("<%=HtmlTag.returnString((String)viewMap.get("grd_cd"),"")%>");		$("#grd_nm").val("<%=HtmlTag.returnString((String)viewMap.get("grd_nm"),"")%>");		$("#pos_nm").val("<%=HtmlTag.returnString((String)viewMap.get("pos_nm"),"")%>");				CmcloseLoading();	}).ajaxStart(function() {         // ajax 통신 시작 callback (로딩바 show)	 //console.log('start');	 CmopenLoading();	//$("#pageDisable").css({"width":"100%","height":($(document).height()+20)+"px","background": "url("+context_root+"/images/loading.gif) no-repeat center rgba(0, 0, 0, 0.5)"});}).ajaxStop(function() {        // ajax 통신 완료 callback (로딩바 hide)	//console.log('end');      	CmcloseLoading();});function setGrdNm(){	$("#grd_nm").val(($("#grd_cd option:selected").text()));	}//조회 : 트리조회//TODO : refreshTreefunction refreshTree(){			//alert('refreshTree');	$("#pstate").val("XL2");	var params =  $("form[name=cffrm]").serialize();	//var params = jQuery('form').serialize();	//var params = com.frm.getParamJSON(document.listfrm);	//alert(params);	$.fn.cmtree.reload('#cmtree_data','<c:url value='/cmsajax.do'/>',params);	}//TODO : treeClickTitle01function treeClickTitle01(rtnArr){	//alert(rtnArr[1]+"---"+rtnArr[4]);	//0: TREE_SEQ, 1: TREE_CD, 2: TREE_NM, 3:TREE_UPPO_CD, 4: TREE_LEVEL, 5: TREE_NMS, 6: TREE_CDS, 7: TREE_SUB_CNT	//$.fn.cmtree.treeRelComboboxSet(rtnArr[1], rtnArr[4]);	//$.fn.cmtree.treeRelComboboxMake(rtnArr[1],'', rtnArr[4]);	$.fn.cmtree.selTreeParentAll(rtnArr[1], rtnArr[4]);//조직트리 해당 조직으로 선택	//$.fn.cmtree.treeRelComboboxMake(rtnArr[1],'', rtnArr[1]);			optionGroupToTree(rtnArr[6], rtnArr[4]);	//	//insertfInit();}//TODO : optionGroupToTreefunction optionGroupToTree(tree_cds, tree_level){	// 역으로 찾아가며 처리한다	var ogi = 0;	//alert(tree_cds+"---"+tree_level);	var tree_cds_sp = tree_cds.split("::");	for(ogi=0;ogi<tree_cds_sp.length;ogi++){		$("select[name='org_option']").eq(ogi).val(tree_cds_sp[ogi]);		optionGroup($("select[name='org_option']").eq(ogi), ogi+1, "N", "","N");			}	}//TODO : optionGroupfunction optionGroup($this, lev, treeyn, treecode, gridreloadyn){	//alert($this.attr("id"));	if(treeyn=="Y"){		$this.val(treecode);		$.fn.cmtree.treeRelComboboxMake(treecode,'', lev);//하위 셀렉트박스 생성		$.fn.cmtree.selTreeParentAll(treecode, lev);//트리 해당 코드로 선택				}else{		if(isEmpty($this.val())){			if(lev>1){				//alert($("select[name='smatrtpcd']").eq(lev-2).val()+"----"+(lev-2));				$.fn.cmtree.treeRelComboboxMake($("select[name='org_option']").eq(lev-2).val(),'', lev-1);//하위 셀렉트박스 생성								$.fn.cmtree.selTreeParentAll($("select[name='org_option']").eq(lev-2).val(), lev-1);//조직트리 해당 조직으로 선택								}else{				$.fn.cmtree.treeRelComboboxMake($this.val(),'', lev);//하위 셀렉트박스 생성								$.fn.cmtree.selTreeParentAll($this.val(), lev);//조직트리 해당 조직으로 선택							}				}else{			$.fn.cmtree.treeRelComboboxMake($this.val(),'', lev);//하위 셀렉트박스 생성						$.fn.cmtree.selTreeParentAll($this.val(), lev);//조직트리 해당 조직으로 선택					}				}		var opt_i = 0;	var opts_str = "";	// 현재 선택된 마지막 분류코드를 불러온다	var selorg_option = "";	var selorg_option_lev = "";	var selorg_option_lev4 = "";	if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){		selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();	}else{		selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();	}	$("input[name='sorg_cd']").val(selorg_option);	}function reloadingUF(){	  su_form=document.cffrm;	  su_form.method='post';	  su_form.pstate.value='UF';	  su_form.action='<%=RequestURL%>';	  su_form.submit();	  su_form.target = "";	}</script><form name="cffrm" id="cffrm" method="post" onSubmit='return false;Go_search();' >        <input type="hidden" name="scode" id="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" id="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" id="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" id="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" id="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="sidx" value="" title="선택된인덱스" /><input type="hidden" name="used" id="used" value="" /><input type="hidden" name="del" id="del" value="" /><input type="hidden" name="suser_id" id="suser_id" value="" /><input type="hidden" name="sorg_cd" id="sorg_cd" value="" /><input type="hidden" name="suser_seq" id="suser_seq" value="<%=viewMap.get("user_seqno") %>" />  <div class="sectionBlue">	<!-- 트리 영역 -->	<div class="treeArea" id="treeArea">		<p class="tit round fL"><a href="#" onclick="cmtreechkCall()">조직도</a>		<!-- p class="tit round fR">		<span class="btn_pack small" id="spbtn_treeunchk" ><a href="#" id="btn_treeunchk" onclick="treechkoff()">특정체크해제</a></span> 		<span class="btn_pack small" id="spbtn_treechk" ><a href="#" id="btn_treechk" onclick="treechkon()">특정체크</a></span>				<span class="btn_pack small" id="spbtn_treeidxchk" ><a href="#" id="btn_treeidxchk" onclick="$.fn.cmtree.selTreeParentAll('0034',4)">운영팀오픈</a></span>		<span class="btn_pack small" id="spbtn_treeidxchk" ><a href="#" id="btn_treeidxchk" onclick="$.fn.cmtree.selTreeParentAll2('0034')">운영팀오픈2</a></span>		 		</p-->		</p>		<div class="treeMenu round fL mR10" id="treeMenu">			<ul id="cmtree_data">			</ul>		</div>	</div>	<!-- 트리 영역 // -->   	<div class="searchArea">	<h3 class="fL"><span>&#8226;</span><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 수정</h3>    <table class="defaultTable02">      <colgroup>      <col width="12%" />      <col width="20%" />      <col width="12%" />      <col width="12%" />      <col width="20%" />      <col width="*" />      </colgroup>      <tr>        <th scope="row">조직선택<span class="pOrg">*</span></th>		<td colspan="5" id="org_select_group" >			<select name="org_option" id="org_option" onchange="optionGroup($(this), 1,'N','')" title="조직 선택">			<option value="">--선택--</option>			</select>                </td>      </tr>            <tr>        <th scope="row">사용자 명<span class="pOrg">*</span></th>        <td colspan="2">            <input type="text" name="user_nm" id="user_nm" maxlength="50" title="" class="fL in" value="<%=HtmlTag.returnString((String)viewMap.get("user_nm"),"") %>" />       </td>                <th scope="row" >사용자 ID</th>        <td colspan="2">            <%=HtmlTag.returnString((String)viewMap.get("user_id"),"") %>       </td>       </tr>                                        </tr>             <tr>	         <th scope="row">사용시작일</th>	        <td colspan="2">	        <div class="item iDate">	            <input type="text" name="fuse_st_ymd" id="fuse_st_ymd" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();"  class="fL in" value="<%=HtmlTag.returnString((String)viewMap.get("use_st_dt"),"") %>" style="width:50%;" /> 	            <span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('fuse_st_ymd'));return false;"></a></span>  	         </div>	       </td>  		         <th scope="row" >사용종료일</th>	        <td colspan="2">	        <div class="item iDate">	            <input type="text" name="fuse_end_ymd" id="fuse_end_ymd" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();"  class="fL" value="<%=HtmlTag.returnString((String)viewMap.get("USE_END_DT"),"") %>" style="width:50%;" /> 	            <span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('fuse_end_ymd'));return false;"></a></span>  	         </div>	       </td>	      </tr>             <tr>	   		<th scope="row">직급</span></th>	        <td colspan="2">				<select name="grd_cd"  id="grd_cd" onchange="setGrdNm();" title="직급 선택">				<option value="">====선택====</option>	         	<%=(String)rtn_Map.get("grd_cd_opts")%>	            </select> 	            <input type="hidden" name="grd_nm" id="grd_nm" value="<%=CM_Util.nullToEmpty((String)viewMap.get("grd_nm"))%>" title=""/>	            	        	      	</td>  		        <th scope="row" >직위</th>	       	<td colspan="2">	       		<input type="text" name="pos_nm" id="pos_nm" maxlength="30" title="" class="fL" value="<%=CM_Util.nullToEmpty((String)viewMap.get("pos_nm"))%>" />           	       		       	</td>      </tr>                    <tr>	   		<th scope="row">핸드폰 번호<span class="pOrg"></span></th>	        <td colspan="2">			<input type="text" name="moblphon" id="moblphon" maxlength="13" title="" class="fL" value="<%=CM_Util.nullToEmpty((String)viewMap.get("moblphon"))%>" onkeyup="maskHp(this)" />	      	</td>  		        <th scope="row" >이메일</th>	       	<td colspan="2">	       		<input type="text" name="user_email1" id="user_email1" maxlength="50" title="" class="fL" value="" style="width:50%;" />	           <select name="user_email2"  id="user_email2" title="이메일 선택">	         	<%=(String)rtn_Map.get("mail_cd_opts")%>	            </select> 	            	       		       	</td>      </tr>                   <tr>      <th scope="row">사용자비고</th>        <td colspan="2">            <input type="text" name="user_desc" id="user_desc"  maxlength="200" title="" class="fL" value="<%=HtmlTag.returnString((String)viewMap.get("user_desc"),"") %>" style="width:90%" />       </td>         <th scope="row" >수정비밀번호</th>        <td colspan="2">            <input type="password" name="login_ipns" id="login_ipns" maxlength="200" title="" class="fL" value="" />       </td>               </tr>                 </table>    </div>	 <div class="section lineTbtn aR mT10 mB5"> 	 	<span class="btn_pack largeG" id="btn_list"><a href="# none;">목록</a></span> 		<span class="btn_pack large"><a href="#" id="btn_modify">수정</a></span> 		<span class="btn_pack largeG"><a href="#" id="btn_delete">삭제</a></span>	 </div>    </div></form>