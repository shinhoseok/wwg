<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /WEB-INF/jsp/ji/cm/oam/jicm_oam_020_a1/* 프로그램 이름     : jicm_oam_020_a1  /* 소스파일 이름     : jicm_oam_020_a1.jsp/* 설명              : SYSTEM 코드관리 목록페이지/* 버전              : 1.0.0/* 최초 작성자       : 이금용/* 최초 작성일자     : 2016-11-07/* 최근 수정자       : 이금용/* 최근 수정일시     : 2016-11-07/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><script language="javascript" src="<%=con_root%>/js/com-tree.js"></script><script type="text/javascript">// 조직트리var searchYn = false;//TODO : $(function()$(function(){	var cmtreeval = new Array();	//init tree	$.fn.cmtree({		 id			: '#cmtree_data' 		 ,treeAreaId : "#treeArea"		 ,treeMenuId : "#treeMenu"		 ,treeHeight : ($("#content").height()-40)+"px"		 ,treeWidth  : "200px"		 ,treemHeight : ($("#content").height()-80)+"px"		 ,treemWidth : "160px"	 		 ,checkBoxYn: false		 ,treeArr   : cmtreeval		 ,onClickTitlefn: "treeClickTitle01"		 ,treeRelComboId : "org_select_group"		 ,treeRelComboboxId : "org_option"		 ,treeImgPath : "<%=img_url%>"	});			//목록 이동		$("#btn_list").click(function(e){			var selorg_option = "";			if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();			}else{				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();			}			$("input[name='sorg_cd']").val(selorg_option);						  su_form=document.cffrm;			  su_form.method='post';			  su_form.pstate.value='L';			  su_form.action='<%=RequestURL%>';			  su_form.submit();			  su_form.target = "";		});				//저장		$("#btn_save").click(function(e){								if(!validation("cffrm")) return false; //필수 체크						if(isEmpty($('input[name=user_nm]').val()) ){				alert("사용자명을 입력해주세요");				$('input[name=user_nm]').focus();				return;						}						// 아이디가 입력되어있을경우 아이디를 체크한다			if(!isEmpty($('input[name=user_id]').val()) ){				if($('input[name=user_id]').val().length > 12){					alert("아이디는 12자리까지만 입력되어야합니다.");					document.getElementsByName("user_id")[0].focus();					return;				}							}else{				alert("사용자 아이디를 입력해주세요");				$('input[name=user_id]').focus();				return;							}									/*			if(isEmpty($('select[name=grd_cd]').val()) ){				alert("직급을 선택해주세요");				$('select[name=grd_cd]').focus();				return;						}						if(isEmpty($('select[name=now_jobduty_cd]').val()) ){				alert("직위를 선택해주세요");				$('select[name=now_jobduty_cd]').focus();				return;						}*/											// 비밀번호가 입력되어있을경우 비밀번호를 체크한다			if(!isEmpty($('input[name=login_ipns]').val()) ){				if($('input[name=login_ipns]').val().length < 9 || $('input[name=login_ipns]').val().length > 20){					alert("비밀번호는 영문,숫자,특수문자 조합으로 9~20자리로 사용해야합니다.");					document.getElementsByName("login_ipns")[0].focus();					return;				}								if(!$('input[name=login_ipns]').val().match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~,(,),+])|([!,@,#,$,%,^,&,*,?,_,~,(,),+].*[a-zA-Z0-9])/)){					alert("비밀번호는 영문,숫자,특수문자 조합으로 9~20자리로 사용해야합니다.");					document.getElementsByName("login_ipns")[0].focus();					return;				}							}			var selorg_option = "";			if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();			}else{				selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();			}			$("input[name='sorg_cd']").val(selorg_option);						   $("#pstate").val("C");				var params = jQuery("#cffrm").serialize();				CmopenLoading();					 $.ajax({			             type: "post",			             url: "<c:url value='/cmsajax.do'/>",			             data: params,			             async: false,			             dataType:"json",			             timeout: 3000,			             error: function (jqXHR, textStatus, errorThrown) {			                 // 통신에 에러가 있을경우 처리할 내용(생략가능)			    	        	alert("네트웍장애가 발생했습니다. 다시시도해주세요");			    	        	CmcloseLoading();            			             },			             			             success: function(data){			               if(data.result==true){			                	alert('저장 되었습니다.');			                	$("#btn_list").trigger("click");			               }else{			            	   	alert(data.TRS_MSG);			            	   	CmcloseLoading();			               }			               			             }			             /*,					     error:function(request, status, error) {					    	 CmcloseLoading();					    	 alert('저장 중 오류가 발생했습니다.');			             }*/			             			             			 			      });		});								CmopenLoading();		refreshTree();//트리조회				// 조직 셀렉트 박스를 만든다		$.fn.cmtree.treeRelComboboxMake('','', 0);			<%		if(!HtmlTag.returnString((String)request.getAttribute("sorg_cd"),"").equals("")){		%>		treeClickTitle01($.fn.cmtree.rtnTreeArr('<%=HtmlTag.returnString((String)request.getAttribute("sorg_cd"),"")%>'));		<%		}		%>		$("#user_email2").val("komipo.co.kr");		CmcloseLoading();});function setGrdNm(){	$("#grd_nm").val(($("#grd_cd option:selected").text()));	}//Grid 데이터 json 데이터로 반환function JSONDataList(jqGrid,field) {	var colModel = $("#"+jqGrid).jqGrid('getGridParam','colModel');	var arrObj = new Array();	var ids = jQuery("#"+jqGrid).jqGrid('getDataIDs');	var _value ="";	var _type ="";    for ( var i=0; i<ids.length; i++ ) {        var vo = new Object();          for(var j=1;j<colModel.length;j++){        	if(colModel[j].name!=""){        		        		//_value = $("#"+field[j-1]+[i+1]).val();        	//$(":input "+field[j-1]+")         		_value = $("#"+jqGrid+" :input[name="+field[j-1]+"]:eq("+i+")").val();        		_type = $("#"+jqGrid+" :input[name="+field[j-1]+"]:eq("+i+")").attr("type");        		//console.log(_type);        		if(_type=="radio"){        			if($("#"+jqGrid+" input:radio[id="+field[j-1]+[i+1]+"]").is(":checked")){        				_value = "Y"        				eval("vo."+colModel[j].name+"=\""+_value+"\"");        			}else{        				_value = "N"        				eval("vo."+colModel[j].name+"=\""+_value+"\"");        			}        		}else{	        		//console.log(colModel[j].name+"      =         " +$("#"+field[j-1]+[i+1]).val()+"        field[j]       "+field[j-1]);	        		if(_value==undefined){	        			eval("vo."+colModel[j].name+"=\"\"");		        		}else{	        			eval("vo."+colModel[j].name+"=\""+_value+"\"");	        		}        		}        		//console.log("vo."+colModel[j].name+"=\""+_value+"\"");        	}        }        arrObj.push(vo);       }    return JSON.stringify(arrObj);}//조회 : 트리조회//TODO : refreshTreefunction refreshTree(){			//alert('refreshTree');	$("#pstate").val("XL2");	var params =  $("form[name=cffrm]").serialize();	//var params = jQuery('form').serialize();	//var params = com.frm.getParamJSON(document.listfrm);	//alert(params);	$.fn.cmtree.reload('#cmtree_data','<c:url value='/cmsajax.do'/>',params);	}//TODO : treeClickTitle01function treeClickTitle01(rtnArr){	//alert(rtnArr[1]+"---"+rtnArr[4]);	//0: TREE_SEQ, 1: TREE_CD, 2: TREE_NM, 3:TREE_UPPO_CD, 4: TREE_LEVEL, 5: TREE_NMS, 6: TREE_CDS, 7: TREE_SUB_CNT	//$.fn.cmtree.treeRelComboboxSet(rtnArr[1], rtnArr[4]);	//$.fn.cmtree.treeRelComboboxMake(rtnArr[1],'', rtnArr[4]);	$.fn.cmtree.selTreeParentAll(rtnArr[1], rtnArr[4]);//조직트리 해당 조직으로 선택	//$.fn.cmtree.treeRelComboboxMake(rtnArr[1],'', rtnArr[1]);			optionGroupToTree(rtnArr[6], rtnArr[4]);	//	//insertfInit();}//TODO : optionGroupToTreefunction optionGroupToTree(tree_cds, tree_level){	// 역으로 찾아가며 처리한다	var ogi = 0;	//alert(tree_cds+"---"+tree_level);	var tree_cds_sp = tree_cds.split("::");	for(ogi=0;ogi<tree_cds_sp.length;ogi++){		$("select[name='org_option']").eq(ogi).val(tree_cds_sp[ogi]);		optionGroup($("select[name='org_option']").eq(ogi), ogi+1, "N", "","N");			}	}//TODO : optionGroupfunction optionGroup($this, lev, treeyn, treecode, gridreloadyn){	//alert($this.attr("id"));	if(treeyn=="Y"){		$this.val(treecode);		$.fn.cmtree.treeRelComboboxMake(treecode,'', lev);//하위 셀렉트박스 생성		$.fn.cmtree.selTreeParentAll(treecode, lev);//트리 해당 코드로 선택				}else{		if(isEmpty($this.val())){			if(lev>1){				//alert($("select[name='smatrtpcd']").eq(lev-2).val()+"----"+(lev-2));				$.fn.cmtree.treeRelComboboxMake($("select[name='org_option']").eq(lev-2).val(),'', lev-1);//하위 셀렉트박스 생성								$.fn.cmtree.selTreeParentAll($("select[name='org_option']").eq(lev-2).val(), lev-1);//조직트리 해당 조직으로 선택								}else{				$.fn.cmtree.treeRelComboboxMake($this.val(),'', lev);//하위 셀렉트박스 생성								$.fn.cmtree.selTreeParentAll($this.val(), lev);//조직트리 해당 조직으로 선택							}				}else{			$.fn.cmtree.treeRelComboboxMake($this.val(),'', lev);//하위 셀렉트박스 생성						$.fn.cmtree.selTreeParentAll($this.val(), lev);//조직트리 해당 조직으로 선택					}				}		var opt_i = 0;	var opts_str = "";	// 현재 선택된 마지막 분류코드를 불러온다	var selorg_option = "";	var selorg_option_lev = "";	var selorg_option_lev4 = "";	if($("select[name='org_option']").eq($("select[name='org_option']").length-1).val() == ""){		selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-2).val();	}else{		selorg_option = $("select[name='org_option']").eq($("select[name='org_option']").length-1).val();	}	$("input[name='sorg_cd']").val(selorg_option);	}</script><form name="cffrm" id="cffrm" method="post" onSubmit='return false;Go_search();' >        <input type="hidden" name="scode" id="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" id="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" id="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" id="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" id="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="sidx" value="" title="선택된인덱스" /><input type="hidden" name="used" id="used" value="" /><input type="hidden" name="del" id="del" value="" /><input type="hidden" name="suser_id" id="suser_id" value="" /><input type="hidden" name="sorg_cd" id="sorg_cd" value="" /><input type="hidden" name="suser_seq" id="suser_seq" />  <div class="sectionBlue">	<!-- 트리 영역 -->	<div class="treeArea" id="treeArea">		<p class="tit round fL"><a href="#" onclick="cmtreechkCall()">조직도</a>		<!-- p class="tit round fR">		<span class="btn_pack small" id="spbtn_treeunchk" ><a href="#" id="btn_treeunchk" onclick="treechkoff()">특정체크해제</a></span> 		<span class="btn_pack small" id="spbtn_treechk" ><a href="#" id="btn_treechk" onclick="treechkon()">특정체크</a></span>				<span class="btn_pack small" id="spbtn_treeidxchk" ><a href="#" id="btn_treeidxchk" onclick="$.fn.cmtree.selTreeParentAll('0034',4)">운영팀오픈</a></span>		<span class="btn_pack small" id="spbtn_treeidxchk" ><a href="#" id="btn_treeidxchk" onclick="$.fn.cmtree.selTreeParentAll2('0034')">운영팀오픈2</a></span>		 		</p-->		</p>		<div class="treeMenu round fL mR10" id="treeMenu">			<ul id="cmtree_data">			</ul>		</div>	</div>	<!-- 트리 영역 // -->   	<div class="searchArea">	<h3 class="fL"><span>&#8226;</span><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 등록</h3>    <table class="defaultTable02">      <colgroup>      <col width="12%" />      <col width="20%" />      <col width="12%" />      <col width="20%" />      <col width="12%" />      <col width="*" />      </colgroup>      <tr>        <th scope="row">조직선택<span class="pOrg">*</span></th>		<td colspan="5" id="org_select_group" >			<select name="org_option" id="org_option" onchange="optionGroup($(this), 1,'N','')" title="조직 선택">			<option value="">--선택--</option>			</select>                </td>      </tr>            <tr>        <th scope="row">사용자 명<span class="pOrg">*</span></th>        <td colspan="2">            <input type="text" name="user_nm" id="user_nm" maxlength="50" title="" class="fL in" value="" />       </td>                <th scope="row" colspan="2">사용자 ID<span class="pOrg">*</span></th>        <td >            <input type="text" name="user_id" id="user_id" maxlength="12" title="" class="fL" value="" />       </td>       </tr>                                        </tr>             <tr>	         <th scope="row">사용시작일</th>	        <td colspan="2">	        <div class="item iDate">	            <input type="text" name="fuse_st_ymd" id="fuse_st_ymd" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();"  class="fL in" style="width:50%;"/> 	            <span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('fuse_st_ymd'));return false;"></a></span>  	         </div>	       </td>  		         <th scope="row" colspan="2">사용종료일</th>	        <td >	        <div class="item iDate">	            <input type="text" name="fuse_end_ymd" id="fuse_end_ymd" onblur="is_valid_date(this);" onkeyup="maskCal();" onfocus="this.select();"  class="fL" style="width:50%;"/> 	            <span class="btnIc_calendar"><a href="#" onclick="Calendar_D(document.getElementById('fuse_end_ymd'));return false;"></a></span>  	         </div>	       </td>	      </tr>              <tr>	   		<th scope="row">직급</th>	        <td colspan="2">				<select name="grd_cd"  id="grd_cd" onchange="setGrdNm();" title="직급선택">				<option value="">====선택====</option>	         	<%=(String)rtn_Map.get("grd_cd_opts")%>	            </select> 	            <input type="hidden" name="grd_nm" id="grd_nm" value="" title=""/>	      	</td>  		        <th scope="row" colspan="2">직위</th>	       	<td >	       		<input type="text" name="pos_nm" id="pos_nm" maxlength="30" title="" class="fL" value="" />	            	       		       	</td>      </tr>                   <tr>             <tr>	   		<th scope="row">핸드폰 번호<span class="pOrg"></span></th>	        <td colspan="2">			<input type="text" name="moblphon" id="moblphon" maxlength="13" title="" class="fL" value="<%=CM_Util.nullToEmpty((String)viewMap.get("moblphon"))%>" onkeyup="maskHp(this)" />	      	</td>  		        <th scope="row" colspan="2">이메일</th>	       	<td >	       		<input type="text" name="user_email1" id="user_email1" maxlength="50" title="" class="fL" value=""  style="width:50%;" />	           <select name="user_email2"  id="user_email2" title="이메일 선택">	         	<%=(String)rtn_Map.get("mail_cd_opts")%>	            </select> 	            	       		       	</td>      </tr>                       <th scope="row">사용자비고</th>        <td colspan="2">            <input type="text" name="user_desc" id="user_desc"  maxlength="200" title="" class="fL" value="" style="width:90%" />       </td>         <th scope="row" colspan="2">초기비밀번호</th>        <td >            <input type="password" name="login_ipns" id="login_ipns" maxlength="200" title="" class="fL" value="" />       </td>               </tr>                 </table>    </div>	 <div class="section lineTbtn aR mT10 mB5"> 	 <span class="btn_pack largeG" id="btn_list"><a href="#" onclick="return false;">목록</a></span>	 <span class="btn_pack large" id="btn_save"><a href="#" onclick="return false;">등록</a></span>	 </div>    </div>   </form>