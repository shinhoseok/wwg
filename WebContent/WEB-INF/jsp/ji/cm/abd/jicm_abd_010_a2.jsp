<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /WEB-INF/jsp/ji/cm/abd/jicm_abd_010_a1.jsp /* 프로그램 이름     : jicm_abd_010_m1    /* 소스파일 이름     : jicm_abd_010_m1.jsp/* 설명              : SYSTEM 게시판 사용자등록, 수정페이지/* 버전              : 1.0.0/* 최초 작성자       : 이금용/* 최초 작성일자     : 2016-11-16/* 최근 수정자       : 이금용/* 최근 수정일시     : 2016-11-16/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><style type="text/css">.qna_write img{width:;}</style><%List code_select_List = null; // 셀렉트박스 생성용 코드리스트List subauth_List = null; // 부분관리자 권한리스트List chk_up_code_List = new ArrayList();List getABDFiles = null; // 첨부파일정보Map rtn_row_map2 = new HashMap();Map ETC_CODE_MAP = new HashMap();String javasc_arr_nm = "";String select_nm = "";String inhtml_id = "";String init_code_param = "";String onchg_func_nm = "";int cprev_lv = 0;int ctmp_lv = 0;int cinit_lv = 0;int ic = 0;int j = 0;int rIDX		= 0;String rM_CODE	= "";String rM_NM 	= "";String rREG_DT	= "";String rMOD_DT	= "";  String rREG_ID	= "";String rMOD_ID	= "";String rB_TITLE	= "";	String rB_CONTENTS	= "";int rREAD_CNT	= 0;int rR_IDX	= 0;int rR_DEPTH	= 0;String rPASSWD	= "";String rGESI_FL	= "";String rGESI_FL_NM	= "";String rREG_NAME	= "";String rREG_MAIL	= "@";String rB_SDATE	= "";String rB_EDATE	= "";String rREG_TEL	= "";String rREG_HAND	= "";String rREG_IP	= "";String rREG_PHOTO_ALT	= "";String rREG_SVNUMBER	= "";String [] rB_ETC_ARR	= new String[10];String rFILE_NMS	= "";String [] rREG_MAIL_sp	= null;String [] rFILE_NMS_arr = null;String display_none = "";	//////////////////// 원글 셋팅부분 //////////////////////////////////////	rtn_row_Map = (Map)rtn_Map.get("getABD"); // 원글의 조회된 상세내용	//System.out.println("rtn_row_Map====== "+rtn_row_Map);	getABDFiles = (List)rtn_Map.get("getABDFiles"); // 원글의 조회된 파일정보	rIDX			= Integer.parseInt(HtmlTag.returnString(String.valueOf(rtn_row_Map.get("DATA_SEQNO")),"0"),10);	rM_CODE	= HtmlTag.returnString((String)rtn_row_Map.get("MENU_CD"),"");	rM_NM 	= HtmlTag.returnString((String)rtn_row_Map.get("MENU_NM"),"");	rREG_DT	= HtmlTag.returnString((String)rtn_row_Map.get("REG_DT"),"");	rMOD_DT	= HtmlTag.returnString((String)rtn_row_Map.get("MOD_DT"),"");  	rREG_ID	= HtmlTag.returnString((String)rtn_row_Map.get("REG_ID"),"");	rMOD_ID	= HtmlTag.returnString((String)rtn_row_Map.get("MOD_ID"),"");	rB_TITLE	= HtmlTag.returnString((String)rtn_row_Map.get("DATA_TITLE"),"");		rB_CONTENTS	= HtmlTag.returnString((String)rtn_row_Map.get("DATA_DESC"),"");	rREAD_CNT	= Integer.parseInt(HtmlTag.returnString(String.valueOf(rtn_row_Map.get("INQ_CNT")),"0"),10);	rR_IDX	= Integer.parseInt(HtmlTag.returnString(String.valueOf(rtn_row_Map.get("DATA_ORIGIN_NO")),"0"),10);	rR_DEPTH	= Integer.parseInt(HtmlTag.returnString(String.valueOf(rtn_row_Map.get("DATA_DEPTH")),"0"),10);	rPASSWD	= HtmlTag.returnString((String)rtn_row_Map.get("DATA_IPNS"),"");	rGESI_FL	= HtmlTag.returnString((String)rtn_row_Map.get("OPEN_YN"),"");	rGESI_FL_NM	= HtmlTag.returnString((String)rtn_row_Map.get("GESI_FL_NM"),"");	rREG_NAME	= HtmlTag.returnString((String)rtn_row_Map.get("REG_ID_NM"),"");	rREG_MAIL	= HtmlTag.returnString((String)rtn_row_Map.get("REG_MAIL"),"");	rB_SDATE	= HtmlTag.returnString((String)rtn_row_Map.get("DATA_SPA_ST_DT"),"");	rB_EDATE	= HtmlTag.returnString((String)rtn_row_Map.get("DATA_SPA_END_YMD"),"");	rREG_TEL	= HtmlTag.returnString((String)rtn_row_Map.get("REG_TEL"),"");	rREG_HAND	= HtmlTag.returnString((String)rtn_row_Map.get("REG_HAND"),"");	rREG_IP	= HtmlTag.returnString((String)rtn_row_Map.get("REG_IP"),"");	rREG_PHOTO_ALT	= HtmlTag.returnString((String)rtn_row_Map.get("REG_PHOTO_ALT"),"");	rREG_SVNUMBER	= HtmlTag.returnString((String)rtn_row_Map.get("REG_SVNUMBER"),"");	for(i=0;i<10;i++){		rB_ETC_ARR[i] = HtmlTag.returnString((String)rtn_row_Map.get("DATA_SPA_COL"+i),"");	}	if(rREG_MAIL==null){		rREG_MAIL_sp[0]="";		rREG_MAIL_sp[1]="";	}else{		rREG_MAIL_sp = HtmlText.split(rREG_MAIL,"@");	}		rFILE_NMS = HtmlTag.returnString((String)rtn_row_Map.get("FILE_NMS"),"");	rFILE_NMS_arr = HtmlText.split(rFILE_NMS,"::");////////////////////원글 셋팅부분 ////////////////////////////////////////////////////////////답변글 셋팅부분 //////////////////////////////////////String reREG_NAME = "";String reREG_DT = "";String reB_SDATE = "";String reREG_MAIL = "";String [] reREG_MAIL_sp	= null;	reREG_NAME	= HtmlTag.returnString((String)SITE_ADM_SESSION.get("USER_NM"),"");	reREG_DT	= curDate.substring(0,4)+"-"+curDate.substring(4,6)+"-"+curDate.substring(6,8);	reB_SDATE	= curDate.substring(0,4)+"-"+curDate.substring(4,6)+"-"+curDate.substring(6,8);	reREG_MAIL	= HtmlTag.returnString((String)SITE_ADM_SESSION.get("USER_EMAIL"),"@");		if(reREG_MAIL==null){		reREG_MAIL_sp[0]="";		reREG_MAIL_sp[1]="";	}else{		reREG_MAIL_sp = HtmlText.split(reREG_MAIL,"@");	}		////////////////////답변글 셋팅부분 //////////////////////////////////////// 이메일주소코드셀렉트박스를 셋팅한다code_select_List = (List)rtn_Map.get("ListTree0000000012"); // 조회된 리스트javasc_arr_nm = "treemenuval_1";select_nm = "dto_SELMENU1_";inhtml_id = "SEL_DIVS1";init_code_param = "";onchg_func_nm = "Chg_0000000012";// 이메일주소셀렉트박스생성은 막아놓는다%><%--@include file="/WEB-INF/jsp/cm/CmCodeSelect.jsp"--%><%// 임시항목의 컬럼에 사용할 코드를 셋팅한다for(i=0;i<=9;i++){		// 임시컬럼의 사용여부가 Y이면	if(BOARD_ETC_ITEM_ARR[i].equals("Y")){		// 임시컬럼의 데이터타입이 C(코드)이면		if(BOARD_ETC_ITEM_TY_ARR[i].equals("C")){			ETC_CODE_MAP.put("ListTreeETC"+i, (List)rtn_Map.get("ListTreeETC"+i));			}	}}%><script language="javascript" src="<%=con_root%>/js/com-file.js"></script>	<script language="javascript" src="<%=con_root%>/js/calendar.js"></script><script type="text/javascript" src="<%=con_root%>/smarteditor/js/HuskyEZCreator.js"></script><script type="text/javascript">$(function(){		var file2 = $.fn.cmfile.init({			 id				: 'cmfile1' 			 ,onClickNamefn	: "fileNameClick1"			 ,img_url 		: "<%=img_url%>"			 ,uploadcnt		: <%=uploadcnt%>			 <%			 // 공지형, 자유형, 답변형, faq, 지원사업공고			 if(BOARD_TY.equals("000010") || BOARD_TY.equals("000011") || BOARD_TY.equals("000012") || BOARD_TY.equals("000052") || BOARD_TY.equals("000223")){			 %>			 ,extchk		: ['GIF','JPG','BMP','PNG','HWP','XLS','XLSX','ZIP','PDF','TIF','DOC','DOCX','PPT','PPTX','TXT']			 <%			 // 갤러리형			 }else if(BOARD_TY.equals("000013")){			 %>			 ,extchk		: ['GIF','JPG','BMP','PNG','ZIP']			 <%			 // 동영상형			 }else if(BOARD_TY.equals("000053")){			 %>			 ,extchk		: ['MP4','WMV','OGG','OGV']			 			 <%			 }			 %>		});	});</script><!--목록시작--><form name="writefrm" method="post"  enctype="multipart/form-data" onsubmit="return false;"><input type="hidden" name="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="se_field" value="<%=se_field%>" title="검색컬럼"  /><input type="hidden" name="se_text" value="<%=se_text%>" title="검색단어"  /><input type="hidden" name="se_code" value="<%=se_code%>" title="검색코드"  /><input type="hidden" name="sidx" value="<%=rIDX%>"><input type="hidden" name="ichk_secret_no" id="ichk_secret_no" value="">                    <div class="viewArea">                        <table class="tableA">                            <caption><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 게시판 읽기 제목, 작성자, 작성일, 첨부파일, 내용 확인</caption>                            <colgroup>                                <col width="*">                                <col width="7%">                                <col width="10%">                            </colgroup>                            <thead>                                <tr>                                    <th colspan="2"><p><%=rB_TITLE.replaceAll("&amp;amp;","&")%></p></th>                                    <th><%--=BOARD_LI_ITEM_NM_ARR[1] --%><%=StringUtil.masking_name(rREG_NAME)%></th>                                    <th><%--=BOARD_LI_ITEM_NM_ARR[3] --%><%=rREG_DT%></th>                                </tr>                                                                <tr style="background:none;border:0px solid #fff;">                                    <td colspan="4">                                        <div class="attach_list">                                            <span>첨부파일</span>                                            <div>						<%					    // 첨부기능이 활성화 된경우만 보여준다							if(getABDFiles!=null){								if(getABDFiles.size() > 0){									for(j=0;j<getABDFiles.size();j++){										rtn_row_map2  = (Map)getABDFiles.get(j);										//IDX, M_CODE, RIDX, FILE_NM, RFILE_NM , ORDER_NO,										%>										<a href="#" class="attachFile" onclick="GoDownfile('<%=pcode%>','<%=rtn_row_map2.get("ridx")%>','<%=rtn_row_map2.get("orderNo")%>');return false;" title="<%=rtn_row_map2.get("fileNm") %> 파일다운로드"><%=rtn_row_map2.get("fileNm") %></a>										<%									}								}else{								%>								등록된 첨부파일이 없습니다.								<%								}							}						%>                                                                                        </div>                                        </div>                                    </th>                                </tr>                                                                 								<%								// 추가컬럼의 출력여부를 확인하여 출력한다								int add_col_cnt = 0;								for(i=0;i<=9;i++){									//System.out.println(i+":"+BOARD_ETC_ITEM);									//System.out.println(i+":"+BOARD_ETC_ITEM_ARR[i]);									if(BOARD_ETC_ITEM_ARR[i].equals("Y")){											add_col_cnt++;									}								}																if(add_col_cnt > 0){									for(i=0;i<=9;i++){										if(BOARD_ETC_ITEM_ARR[i].equals("Y")){								%>										<!-- 등록일 타이틀명 -->                                <tr style="background:none;border:0px solid #fff;">                                    <th colspan="4" >                                        <div class="attach_list">                                            <span><%=BOARD_ETC_ITEM_NM_ARR[i] %></span>                                            <div style="margin-left:30px;">												  <%											      // 문자											      if(BOARD_ETC_ITEM_TY_ARR[i].equals("V")){											      %>											      <%=(rB_ETC_ARR[i]==null?"":rB_ETC_ARR[i].replaceAll("&lt;x-",""))%>											      <%											      // 숫자형											      }else if(BOARD_ETC_ITEM_TY_ARR[i].equals("N")){											      %>											      <%=rB_ETC_ARR[i]%>											      <%											      // 날짜형											      }else if(BOARD_ETC_ITEM_TY_ARR[i].equals("D")){											      %>											      <%=rB_ETC_ARR[i]%>											      <%											      // 코드형											      }else if(BOARD_ETC_ITEM_TY_ARR[i].equals("C")){											      	code_select_List = (List)rtn_Map.get("ListTreeETC"+i);											        if(code_select_List!=null){											      		for(j=0;j<code_select_List.size();j++){											      			rtn_row_map2 = (Map)code_select_List.get(j);											      			if(rB_ETC_ARR[i].equals((String)rtn_row_map2.get("stdinfoDtlCd"))){											      	%>											      	<%=rtn_row_map2.get("stdinfoDtlNm")%>											      	<%											      			}											      		 }											      	  }											      }											      %>&nbsp;                                                                                        </div>                                        </div>                                    </th>                                </tr>                                                                                         																		<%										}									}// for 종료								}								%>                                                                                            </thead>                            <tbody>                                                           <tr>                                    <td colspan="4" class="content" style="text-align:left;">									<%=rB_CONTENTS.replaceAll("&amp;","&").replaceAll("&amp;","&").replaceAll("\"","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("\r\n", "<br />") %>                                                                        </td>                                </tr>                            </tbody>                        </table>                  </div>                                      <div class="writeArea">                        <table class="tableC">                            <caption><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 신청서 등록-작성자명,작성일</caption>                            <colgroup>                                <col width="10%">                                <col width="30%%">                                <col width="10%">                                <col width="*">                            </colgroup>                            <thead>                                <tr style="height:50px;">                                    <th colspan="4"><p>신청서 등록</p></th>                                </tr>                                                        </thead>                             <tbody>                                <tr>                                    <th><%=BOARD_LI_ITEM_NM_ARR[0] %></th>                                    <td colspan="3"><input type="text" id="B_TITLE" name="B_TITLE" value="<%=(BOARD_TY.equals("000052")?"":"["+rB_TITLE+" 신청서] ") %>" maxlength="100" title="제목" style="width:100%;"/></td>                                </tr>                                </tr>                                                                <tr>                                    <th><%=BOARD_LI_ITEM_NM_ARR[1] %></th>                                    <td id="REG_NM_STR">							        	<%							        	if(!BOARD_TY.equals("000417")){							        	%>							        	<%if(pstate.equals("RUF")){%><%=reREG_NAME%><%}else{ %><%=userNm %><%} %>							        	<input type="hidden" id="REG_NAME" name="REG_NAME" title="작성자명" value="<%if(pstate.equals("RUF")){%><%=reREG_NAME%><%}else{ %><%=userNm %><%} %>"  />							        	<%							        	}else{							        	%>							        	<input type="text" id="REG_NAME" name="REG_NAME" title="작성자명" value="<%if(pstate.equals("RUF")){%><%=reREG_NAME%><%}else{ %><%} %>"  />							        	<%							        	}							        	%>                                                                        </td>									<th>작성일</th>                                    <td>						 				<%=reREG_DT %>							          	<input type="hidden" id="curDate" name="curDate" title="작성일" value="<%=reREG_DT %>"  />                                                                         </td>                                    	                                                                              </tr>                                                                <tr>                                    <td colspan="4" class="content">                                       	  		<%													// 에디터 환경설정													String editor_table_size = "100%";													String editor_form_content="B_CONTENTS";													String editor_cdiv="cdiv";														String editor_form_name = "listfrm";													String editor_dir_path = "/editer";																%>												<textarea name="<%=editor_form_content %>" id="<%=editor_form_content %>" style="width:100%;min-height:350px;"><%if(pstate.equals("RUF")){%><%=rB_CONTENTS%><%}%></textarea>                                                                      </td>                                </tr>                                                                <tr>                                    <th>첨부파일</th>                                    <td colspan="3">                                    	<div id="cmfile1"></div> 								          <input type="hidden" id="REG_MAIL1" name="REG_MAIL1" title="이메일 아이디명 입력" value=""  />										  <input type="hidden" id="REG_MAIL2" name="REG_MAIL2" title="이메일 도메인 입력" value="" />		      									      <!-- 답변글은 게시구분을 선택할수 없고 원글의 게시구분이 P일경우 원글과 동일하게 셋팅한다 -->									      <input type="hidden" name="GESI_FL" title="게시구분" value="<%if(rGESI_FL.equals("P")){ %>P<%}else{ %>Y<%} %>" />									      <input type="hidden" name="PASSWD" title="비밀번호" value="<%if(rGESI_FL.equals("P")){ %><%=rPASSWD %><%}else{ %><%} %>" />                                    	                                    </td>                                </tr>                                                            </tbody>                        </table>                  </div>                                               <div class="btnArea">       					<%					if(scode.equals("S01")){											if(pstate.equals("RUF")){					%>							<a href="#" id="btn_modify" class="blueBtn" onclick='Go_wrin<%=pstate%>();return false;'>수정</a>					<%							}else{					%>							<a href="#" id="btn_reg" class="blueBtn" onclick='Go_wrin<%=pstate%>();return false;'>등록</a>					<%										}					}					%>								<a href="#" id="btn_list" class="btnBL2" onclick='Go_list();return false;'>목록</a>				</div>	</form>	<script type='text/javascript'>//<![CDATA[	//글등록처리페이지이동	function Go_wrin<%=pstate%>(){	  su_form=document.writefrm;		//alert("11");		if (isEmpty(su_form.B_TITLE.value)){			alert("제목을 입력해주십시오");			su_form.B_TITLE.focus();			return;		}				if(getLength(su_form.B_TITLE.value) > 300){			alert("제목의 입력내용이 너무 깁니다");			su_form.B_TITLE.focus();			return ;				}					// textarea에 값 삽입		//oEditors.getById["<%=editor_form_content %>"].exec("UPDATE_CONTENTS_FIELD", []);				/*var obj = document.getElementById("<%=editor_cdiv%>");			var objDoc = obj.contentWindow || obj.contentDocument;			objDoc.gogo();*/			if(isEmpty(su_form.<%=editor_form_content%>.value)){			   alert('내용을 입력해주세요');			   return;			}			  su_form.target = "successIframe";			  su_form.pstate.value='RE';  	  su_form.action='<%=RequestURL%>';	  su_form.submit();	  su_form.target = "";	}		function Go_list(){		  su_form=document.writefrm;		  su_form.pstate.value='L';		  su_form.action='<%=RequestURL%>';		  su_form.submit();		  su_form.target = "";			}    	// 파일다운로드	function GoDownfile(fpcode,sidx,fidx){		url = "<%=RequestURL%>?scode=000008&pcode=000015&pstate=FILEDOWN"+"&fpcode="+fpcode+"&sidx="+sidx+"&fidx="+fidx;		document.getElementById("successIframe").src = url;			}    //=== 영문, 숫자 혼용 확인    // 혼용이면 true, 아니면 false    function engnum_mix_chk(str)    {    	var chk_num = str.search(/[0-9]/g);    	var chk_eng = str.search(/[a-z]/ig);    	if(chk_num < 0 || chk_eng < 0)    	{    		return false;    	}    	return true;    }			    function onlyEng(objtext1) {	    var inText = objtext1.value;	    var ret;		    for (var i = 0; i < inText.length; i++) {	       ret = inText.charCodeAt(i);	      if ((ret > 122) || (ret < 48) || (ret > 57 && ret < 65) || (ret > 90 && ret < 97)) {	         alert("영문자와 숫자만을 입력하세요");	         objtext1.value = "";	         objtext1.focus();	         return false;	      }	    }	    return true;    }    	function containsChars(obj, chars){				for(var inx=0; inx < obj.value.length; inx++){			if(chars.indexOf(obj.value.charAt(inx)) != -1)return false;		}		return true;	}  		///////////////////////////////////////////// 첨부파일관련 /////////////////////////////////////////////////	$(document).ready(function() {		// 화면이 로드될경우 초기셋팅값을 보여준다		//$(".viewArea").find(".content").find("img").css({"width":""});		$(".viewArea").find(".content").find("img").each(function (idx) {			//console.log($(this).get(0).tagName);			//console.log($(this).get(0).title);			//console.log("111==>"+$(this).get(0));			//$(this).get(0).style.removeProperty("width");				//console.log("222==>"+$(this).get(0));			//$(this).css({width:''});			//$(this).removeProp("width");			//$(this).prop("width","");			//$(this).attr("width","");			//console.log("333==>"+$(this).get(0));		});						});	//]]></script>