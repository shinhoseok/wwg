<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /WEB-INF/jsp/ji/cm/jicm_abd_010_s4.jsp /* 프로그램 이름     : jicm_abd_010_s4    /* 소스파일 이름     : jicm_abd_010_s4.jsp/* 설명              : SYSTEM 게시판관리 일정형목록페이지/* 버전              : 1.0.0/* 최초 작성자       : 이금용/* 최초 작성일자     : 2016-11-16/* 최근 수정자       : 이금용/* 최근 수정일시     : 2016-11-16/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><%//Map rtn_row_Map = new HashMap();Map rtn_page_List = new HashMap();List rtn_tmp_List = new ArrayList();List code_select_List = new ArrayList(); // 셀렉트박스 생성용 코드리스트Map rtn_row_map2 = new HashMap();String tab_sel = HtmlTag.returnString((String)request.getAttribute("tab_sel"),"1");rtn_page_List = (Map)rtn_Map.get("PageListABD"); // 조회된 페이지 리스트rtn_tmp_List = (List)rtn_page_List.get("setList"); // 조회된 페이지 리스트String ssidx = (String)rtn_Map.get("sidx");String mode = (String)rtn_Map.get("mode");String tail_gbn = "";int arti_No = 0;//가상순번int j = 0;int k = 0;int list_title_cnt =1;int etc_chk_cnt = 0;int startday = (rtn_Map.get("startday")==null)? 0 : (Integer)rtn_Map.get("startday");//int startday = (int)rtn_Map.get("startday");int endday =   (rtn_Map.get("endday")==null)? 0 : (Integer)rtn_Map.get("endday");//int endday = (int)rtn_Map.get("endday");String cyear = (String)rtn_Map.get("cyear");String cmonth = (String)rtn_Map.get("cmonth");Calendar cal = Calendar.getInstance();String today = String.valueOf(cal.get(Calendar.YEAR))		+ ((cal.get(Calendar.MONTH)+1) > 9 ? 		String.valueOf(cal.get(Calendar.MONTH)+1) :		"0"+String.valueOf(cal.get(Calendar.MONTH)+1))		+ ((cal.get(Calendar.DATE)) > 9 ? 				String.valueOf(cal.get(Calendar.DATE)) :			"0"+String.valueOf(cal.get(Calendar.DATE)));//오늘 일(DD)int itoday_day = cal.get(Calendar.DATE);%><!--목록시작--><script language="javascript" src="<%=con_root%>/js/com-file.js"></script>      <!-- 검색 -->		<!--// jqGrid -->		<script type="text/javascript">		var searchYn = false;		$(function(){			//refreshGrid(); //조회					});						//조회 : 그리드 조회		function refreshGrid(){			var _frm = document.listfrm;			//_frm.curr_page.value=1;			searchYn = true;			_frm.action='<%=RequestURL%>';			var params = getGridParamDatas();			com.grid.reload('#jqGrid','<c:url value='/cmsajax.do'/>',params);		}				//그리드 조회시 요청할 파라미터 object		function getGridParamDatas(){			var _params = com.frm.getParamJSON(document.listfrm);			_params.pstate = 'X';			return _params;		}						</script><form name="listfrm" id="listfrm" method="post" action="<%=RequestURL%>" onSubmit='return false;Go_search();' ><!-- 조회된등록수: <%=rtn_page_List.get("setTotalCount")%> 건<br />--><input type="hidden" name="scode" id="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" id="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" id="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" id="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" id="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="sidx" id="sidx" value=""><input type="hidden" name="rdate" id="rdate" value=""><input type="hidden" name="tab_sel" id="tab_sel" value="<%=tab_sel%>"><div style="margin-top:50px">					<div class="board_top schedule" style="position:relative;">						<div class="select year">							<input type="hidden" name="cyear" id="cyear" value="<%=cyear %>"/>							<a href="#" class="select"><%=cyear %>년</a>							<div>						    <% for (int y=Integer.parseInt(cyear)-10; y<=Integer.parseInt(cyear)+10; y++) { 						    %>						        <a href="#" onclick="fn_moveYear('<%=y%>');return false;"><%=y%>년</a>						    <% } %>														</div>						</div>						<div class="select month">							<input type="hidden" name="cmonth" id="cmonth" value="<%=cmonth%>"/>							<a href="#" class="select"><%=cmonth%>월</a>							<div>						    <% for (int m=1; m<=12; m++) { 						    	String sm = ((m>9)?String.valueOf(m):"0"+String.valueOf(m));						    %>						        <a href="#" onclick="fn_moveMonth('<%=sm%>');return false;"><%=m%>월</a>						    <% } %>														</div>						</div>						<div class="btnArea">							<a href="#" class="btn on" onclick="monthtab('1');return false;" id="btn_tab_1"><strong class="calendar">달력</strong></a>							<a href="#" class="btn" onclick="monthtab('2');return false;"  id="btn_tab_2"><strong class="list">리스트</strong></a>						</div>					</div>					<!--//board_top--></div>									<div id="month_tab_con_1" class="calendar">					<table class="table schedule" border="0" cellspacing="0" cellpadding="0" summary="<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%>달력입니다.">						<caption><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 달력-일,월,화,수,목,금,토</caption>						<colgroup>							<col width="15%" />							<col width="14%" />							<col width="14%" />							<col width="14%" />							<col width="14%" />							<col width="14%" />							<col width="15%" />						</colgroup>						<thead>							<tr>								<th scope="col" class="sun">SUN</th>								<th scope="col">MON</th>								<th scope="col">TUE</th>								<th scope="col">WEN</th>								<th scope="col">THU</th>								<th scope="col">FRI</th>								<th scope="col" class="last sat">SAT</th>							</tr>						</thead>						<tbody>						<%							int len = 0;							if (rtn_tmp_List != null) len = rtn_tmp_List.size();							i = 0;//list의 검색 시작 위치													String span_class = "date";							int days = 0;//당력표시일자							String nym = cyear+cmonth;													for(int w=0; w<6; w++) {						%>								<tr>						<%		for(int d=0; d<7; d++) {									if (d==0) span_class = "date sun";									else if (d==6) span_class = "date sat";									else span_class = "date";						%>												<td><div <% if ((days+1)==itoday_day){ %>class="today"<%} %>>						<%			if (((d+1) >= startday || w > 0) && days < endday) {										++days; 										String cdate = ((days > 9) ? String.valueOf(days) : "0"+String.valueOf(days));										String nymd = nym + cdate;						%>										<span class="<%=span_class%>"><a href="#" onclick="Go_ofNot('<%=days %>');return false;"><%=days %></a></span>						<%						//System.out.println("nymd:::==>"+nymd);											for (i=0 ; i < len; i++) {												HashMap m = (HashMap)rtn_tmp_List.get(i);												// 일정시작일과 종료일사이의 일자이면 보여준다 data_spa_st_dt  												//System.out.println("m:::==>"+m.get("data_spa_st_dt")+"");												//System.out.println("nymd:::==>"+nymd);												if(Integer.parseInt(((String)m.get("data_spa_st_dt")).replaceAll("-","")) <= Integer.parseInt(nymd)													&& Integer.parseInt(((String)m.get("data_spa_end_dt")).replaceAll("-","")) >= Integer.parseInt(nymd)){																 			if(((String)m.get("data_title")).length() > 10) {%>														<a href="#" onclick="Go_popView(<%=m.get("data_seqno") %>,'<%=((String)m.get("data_title"))%>','<%=m.get("data_spa_st_dt") %> ~ <%=m.get("data_spa_end_dt") %>','<%=((String)m.get("data_desc")).replaceAll("\\r\\n","<br />")%>');return false;" class="event<%if(Integer.parseInt(nymd) < Integer.parseInt(curDate)){ %> past<%}%>">&nbsp;&nbsp;<%=((String)m.get("data_title")).substring(0,10)%></a>												 <% } else { %>														<a href="#" onclick="Go_popView(<%=m.get("data_seqno") %>,'<%=((String)m.get("data_title"))%>','<%=m.get("data_spa_st_dt") %> ~ <%=m.get("data_spa_end_dt") %>','<%=((String)m.get("data_desc")).replaceAll("\\r\\n","<br />")%>');return false;" class="event<%if(Integer.parseInt(nymd) < Integer.parseInt(curDate)){ %> past<%}%>">&nbsp;&nbsp;<%=((String)m.get("data_title"))%></a>												<%				   			}		%>										 		<%													if(i == len-1){														Thread.yield();													}																		} else {													if(i == len-1){														Thread.yield();													}																		}																							}															} %>																	</div></td>												<%		} %>													</tr>												<%	if(days >= endday) break;													} %>												</tbody>											</table>												</div>		<div id="month_tab_con_2" style="display:none;width:100%;margin-top:10px;">					<table class="table schedule" border="0" cellspacing="0" cellpadding="0" summary="<%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 목록입니다.">						<caption><%=M_PATH_STR.substring(M_PATH_STR.lastIndexOf("::")+2)%> 목록-행사일,행사내용,상세보기</caption>						<colgroup>							<col width="14%" />							<col width="11%" />							<col width="62%" />							<col width="12%" />						</colgroup>						<thead>							<tr>								<th scope="col" colspan="2">행사일</th>								<th scope="col">행사내용</th>								<th scope="col" class="last">상세보기</th>							</tr>						</thead>						<tbody id="list_data_obj">							<tr><td colspan='4'>조회된 데이터가 없습니다.</td></tr>						</tbody>					</table>		</div></form>										<!-- 행사 자세히 보기 레이어팝업 영역 -->										<div id="data_pop_div" style="position:absolute;top:0%;left:0%;z-index:9000;width:600px;display:none;"> <!-- 레이어 팝업 숨김 시 style="display:none;" 적용 -->											<!-- <div class="pop_body"></div> -->											<div class="pop_schedule on">												<p id="data_pop_title"></p>												<table class="table" border="0" cellspacing="0" cellpadding="0" summary="자세히 보기입니다.">													<caption>자세히 보기-일자</caption>													<colgroup>														<col width="15%" />														<col width="35%" />														<col width="15%" />														<col width="35%" />													</colgroup>													<tbody>														<tr>															<th scope="row">일자</th>															<td colspan="3" class="last" id="data_pop_date"></td>														</tr>														<!-- 														<tr>															<th scope="row">첨부파일</th>															<td colspan="3" class="last">															<%															// 첨부파일이 있으면 출력한다																														%>															</td>														</tr>														 -->														<tr>															<td colspan="4" class="last cont" id="data_pop_cont">																															</td>														</tr>													</tbody>												</table>												<div class="btnArea">													<a href="#" class="btn" onclick="Go_popClose();return false;"><strong>닫기</strong></a>																									</div>												<a href="#" class="btn_close" onclick="Go_popClose();return false;">닫기</a>											</div>										</div>										<!--//행사 자세히 보기 레이어팝업 영역 --><script type='text/javascript'>$(document).ready(function() {		var mode = '<%=mode %>';	if('main'==mode){		Go_View('<%=pcode%>','<%=ssidx %>');	}			// 등록, 수정 객체를 body 에 append한다	$("body").append($('#data_pop_div'));	// 등록, 수정 폼 드래그앤 드롭 이동    $('#data_pop_div').draggable({ opacity:"0.3" }); // 끄는 동안만 불투명도 주기			    $("body").droppable({        accept: "#data_pop_div",    // 드롭시킬 대상 요소        drop: function(event, ui) {        	$('#data_pop_div').css({ opacity:"1.0" });        }    });		    monthtab($("#tab_sel").val());    refreshAbd();});//<![CDATA[           //TODO : refreshAbdfunction refreshAbd(){		$("#pstate").val("X");	var params =  $("form[name=listfrm]").serialize();	$("#list_data_obj").html("");	CmopenLoading();	 $.ajax({        type: "post",        url: "<c:url value='/cmsajax.do'/>",        data: params,        async: false,        dataType:"json",        timeout: 3000,        error: function (jqXHR, textStatus, errorThrown) {            // 통신에 에러가 있을경우 처리할 내용(생략가능)	        	alert("네트웍장애가 발생했습니다. 다시시도해주세요");	        	CmcloseLoading();                  },			                     success: function(data){           if(data.result==true){				if(data.rows!=""){					//console.log("fdfs::"+(data.total/$("#show_rows").val())+"::"+Math.ceil(data.total/$("#show_rows").val())+"::"+$("#page_info_id").html());					//page:1 현재 page번호 records:1 전체 record수 result:true rows:Array[1] total:1 전체 page번호					//$("#page_info_id").html(data.page+"/"+Math.ceil(data.total/$("#show_rows").val())+"페이지");					//$("#page_info_id").html(data.page+"/"+data.total+"페이지");					AbdListToHtml(data);				}else{					//$("#page_info_id").html("0/0페이지");					$("#list_data_obj").append("<tr><td colspan='4'>조회된 데이터가 없습니다.</td></tr>");				}                      }else{	        	alert(data.TRS_MSG);	        	top.location.href="<%=RequestURL%>";	        	           }			          	$("#pstate").val("L");          	CmcloseLoading();        }	});	} //TODO : AbdListToHtmlfunction AbdListToHtml(res_data){	var hi=0;	var hj=0;	var list_html = "";	var desc_html = "";	var arti_No = 0;	var rows = res_data.rows;	//console.log("111111111111111111111");			// 이전 조회결과값을 지운다	$("#list_data_obj").html(list_html);	for(hi=0;hi<rows.length;hi++){		list_html = "<tr>";		arti_No=  parseInt(res_data.records,10) - parseInt($("#show_rows").val(),10)*(parseInt(res_data.page,10)-1)-hi;		//console.log("res_data.record:"+res_data.records+":res_data.page:"+res_data.page+":$(#show_rows).val():"+$("#show_rows").val()+":hi:"+hi);				//console.log("2222222222222222222");		  <% 		  /*		  {"row_seq":1			  ,"open_yn":"Y"			  ,"data_spa_st_dt":null			  ,"reg_dt":"2017-02-10"			  ,"open_yn_nm":"일반게시"			  ,"file_seq":"21"			  ,"file_nms":"test_file.txt"			  ,"data_title":"테스트"			  ,"menu_nm":"해외조달 시장설명회"			  ,"rpy_cnt":0			  ,"photo_image_alt":null			  ,"data_desc":"테스트&lt;p&gt;&amp;nbsp;&lt;/p&gt;"			  ,"file_group_nm":null			  ,"data_seqno":"41"			  ,"data_spa_end_dt":null			  ,"data_spa_col9":null			  ,"data_depth":"1"			  ,"menu_cd":"000081"			  ,"data_spa_col8":null			  ,"data_sort_no":"1"			  ,"file_group_seq":null			  ,"data_origin_no":"41"			  ,"inq_cnt":"0"			  ,"num_of_rows":"1"			  ,"data_spa_col1":null			  ,"reg_id":"E00000001"			  ,"data_spa_col0":null			  ,"data_spa_col3":null			  ,"data_spa_col2":null			  ,"data_spa_col5":null			  ,"data_spa_col4":null			  ,"data_spa_col7":null			  ,"reg_id_nm":"관리자"			  ,"data_spa_col6":null}		  */		  %>		  		  list_html = list_html+"<th scope=\"row\" colspan=\"2\">"+rows[hi].data_spa_st_dt.substring(5,10)+" ~ "+rows[hi].data_spa_end_dt.substring(5,10)+"</th>";		  list_html = list_html+"<td class=\"a_left\">"+rows[hi].data_title+"</td>";		  list_html = list_html+"<td class=\"last\"><a href=\"#\" onclick=\"Go_popView("+rows[hi].data_seqno+",'"+rows[hi].data_title+"','"+rows[hi].data_spa_st_dt+" ~ "+rows[hi].data_spa_end_dt+"','"+rows[hi].data_desc+"');return false;\">자세히 보기</a></td>";		  list_html = list_html+"</tr>";  			//desc_html = rows[hi].data_desc.replace(/&lt;/gi,"<")			//desc_html = desc_html.replace(/&gt;/gi,">");			//desc_html = desc_html.replace(/&amp;/gi,"&");						$("#list_data_obj").append(list_html);						}// FOR 종료	}function monthtab(tabidx){	$("[id^=btn_tab_]").removeClass("on");	$("#btn_tab_"+tabidx).addClass("on");	$("[id^=month_tab_con_]").hide();	$("#month_tab_con_"+tabidx).show();	$("#tab_sel").val(tabidx);	}function Go_View(pcode,pidx){	  su_form=document.listfrm;	  su_form.method='post';	  su_form.pcode.value=pcode;	  su_form.sidx.value=pidx;	  su_form.pstate.value='R';	  su_form.action='<%=RequestURL%>';	  	  su_form.submit();	  su_form.target = "";}function fn_moveMonth(move) {	$("form[name=listfrm]").find("#cmonth").val(move);	//alert($("form[name=listfrm]").find("#cmonth").val());	//$("form[name=listfrm]").find("#pstate").val("L");		//$("form[name=listfrm]").submit();	document.listfrm.submit();}function fn_moveYear(move) {	$("form[name=listfrm]").find("#cyear").val(move);	//$("form[name=listfrm]").find("#pstate").val("L");	//$("form[name=listfrm]").submit();	document.listfrm.submit();}function Go_ofNot(date){	su_form=document.listfrm;	var rdate = su_form.cyear.value			+ su_form.cmonth.value			+ ((Number(date)>9)? date : "0"+date);		su_form.rdate.value = rdate;}function Go_popView(pop_idx,pop_title, pop_date, pop_cont){	//CmopenpageDisable();	var i = 0;	$("#sidx").val(pop_idx);	$("#data_pop_title").html(pop_title);	$("#data_pop_date").html(pop_date);	$("#data_pop_cont").html(pop_cont);		// 수정, 등록창의 위치를 잡는다		$("#data_pop_div").css("left",( (($(document).width() - 600) / 2) + $(document).scrollLeft() )+"px");		$("#data_pop_div").css("top", ((($(document).height() - 500) / 2) + $(document).scrollTop() )+"px");			//alert($("#org_text_div").scrollTop()+"==>"+sc_pos);		$("#pop_schedule").css("position", "absolute");		$("#data_pop_div").show(500);				}function Go_popClose(){	//CmopenpageDisable();	var i = 0;	$("#sidx").val("");			$("#data_pop_div").hide();			}// 파일다운로드function GoDownfile(file_seqno){	$.fn.cmfile.fileDownLoad("",file_seqno);}	function sechnotin(){	   var m_Sp = /[$\\@\\\#%\^\&\*\(\)\[\]\+\_\{\}\`\~\=\|\<\>]/;	   var m_val = document.getElementsByName("se_text")[0].value;	   var strLen = m_val.length;	   var m_char = m_val.charAt((strLen) - 1);	   if(m_char.search(m_Sp) != -1) {	      alert("특수문자는 사용할수없습니다.");	      document.getElementsByName("se_text")[0].value = "";	      document.getElementsByName("se_text")[0].focus();	      return;	   }}function srchCheck(){	if(event.keyCode==13){		$("#btn_search").trigger("click");	}}//#####문자체크function char_chk(str,chk){	for(i = 0; i < str.length; i++){		c = str.charAt(i);		if(c == chk){			return false;		}	}}//]]></script>