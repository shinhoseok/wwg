<%--/*=================================================================================*//* 시스템            : JRCMS 시스템 SYSTEM/* 프로그램 아이디   : /* 프로그램 이름     : jicm_abd_010_s1    /* 소스파일 이름     : jicm_abd_010_s1.jsp/* 설명              : SYSTEM 게시판관리 공지형목록페이지/* 버전              : 1.0.0/* 최초 작성자       : 이금용/* 최초 작성일자     : 2016-11-16/* 최근 수정자       : 이금용/* 최근 수정일시     : 2016-11-16/* 최종 수정내용     : 최초작성/*=================================================================================*/--%><%@page pageEncoding="utf-8"%><%//Map rtn_row_Map = new HashMap();Map rtn_page_List = new HashMap();List rtn_tmp_List = new ArrayList();List code_select_List = new ArrayList(); // 셀렉트박스 생성용 코드리스트Map rtn_row_map2 = new HashMap();rtn_page_List = (Map)rtn_Map.get("PageListABD"); // 조회된 페이지 리스트rtn_tmp_List = (List)rtn_page_List.get("setList"); // 조회된 페이지 리스트String ssidx = (String)rtn_Map.get("sidx");String mode = (String)rtn_Map.get("mode");String tail_gbn = "";int arti_No = 0;//가상순번int j = 0;int k = 0;int list_title_cnt =1;int etc_chk_cnt = 0;%><!--목록시작--><script language="javascript" src="<%=con_root%>/js/com-file.js"></script><form name="listfrm" id="listfrm" method="post" onSubmit='return false;Go_search();' ><!-- 조회된등록수: <%=rtn_page_List.get("setTotalCount")%> 건<br />--><input type="hidden" name="scode" value="<%=scode%>" title="사이트코드" /><input type="hidden" name="pcode" value="<%=pcode%>" title="페이지코드"  /><input type="hidden" name="pstate" value="<%=pstate%>" title="페이지상태"  /><input type="hidden" name="curr_page" value="<%=curr_page%>" title="현재페이지번호"  /><input type="hidden" name="show_rows" value="<%=show_rows%>" title="현재페이지당데이터수"  /><input type="hidden" name="sidx" value=""><div class="searchArea mT10 ">  <table class="tbl_search">    <colgroup>    <col width="60" />    <col width="150" />    <col width="60" />    <col width="150" />    <col width="*" />     <col width="*" />    </colgroup>    <tr>      <th scope="row">검색구분</th>      <td>        <select name="se_field" title="검색구분">    		<option value="B_TITLE" <%if(se_field.equals("B_TITLE")){ %>selected="selected"<%} %> id="sc_title">제목</option>            <option value="B_CONTENTS" <%if(se_field.equals("B_CONTENTS")){ %>selected="B_CONTENTS"<%} %> id="sc_writer">내용</option>        </select>      </td>      <th scope="row">검색어</th>      <td>          <input type="text" name="se_text" value="<%=se_text %>" id="textfield" Onkeypress="srchCheck()" onKeyUp="sechnotin();" />	  </td>  	<td class="aR">    <span class="btn_pack large"><a href="#none" id="btn_search">검색</a></span>	</td>  	     	      </tr>           </table>  </div>                  <!-- 검색 -->		<!--// jqGrid -->		<script type="text/javascript">		var searchYn = false;		$(function(){			var cols = [{ label:'번호', name:'num_of_rows', align:'center', width:'55', hidden:false, formatter:null }]			<% //제목			    if(BOARD_LI_ITEM_ARR[0].equals("B_TITLE")){ %>			    cols.push({ label:'<%=BOARD_LI_ITEM_NM_ARR[0] %>', name:'data_title', align:'left', width:'309', hidden:false, formatter:brdmodify });			<%  } %>			<% //첨부			    if(BOARD_OPT_ARR[3].equals("Y")){ %>			    cols.push({ label:'첨부', name:'file_nms', align:'center', width:'94', hidden:false, formatter:brdfile_nms });			    cols.push({ label:'첨부', name:'file_seq', align:'center', width:'94', hidden:true, formatter:null });			<%  } %>			<% //작성자			    if(BOARD_LI_ITEM_ARR[1].equals("REG_NAME")){ %>			    cols.push({ label:'<%=BOARD_LI_ITEM_NM_ARR[1] %>', name:'reg_id_nm', align:'center', width:'83', hidden:false, formatter:null });			<%  } %>			<% //작성일			    if(BOARD_LI_ITEM_ARR[3].equals("REG_DT")){ %>			    cols.push({ label:'<%=BOARD_LI_ITEM_NM_ARR[3] %>', name:'reg_dt', align:'center', width:'103', hidden:false, formatter:null }); //셀병합			<%  } %>			<% //조회수			    if(BOARD_LI_ITEM_ARR[2].equals("READ_CNT")){ %>			    cols.push({ label:'<%=BOARD_LI_ITEM_NM_ARR[2] %>', name:'inq_cnt', align:'center', width:'60', hidden:false, formatter:null });			<%  } %>			<% //진행상태는 공지형,자유형과 갤러리형, 통합형은 제외된다 			    if((!BOARD_TY.equals("000010") && !BOARD_TY.equals("000011") && !BOARD_TY.equals("000013")) 			        && (BOARD_TY.equals("000014") && BOARD_INT_TY.equals("000010") || BOARD_TY.equals("000010")) ){			%>			    cols.push({ label:'진행상태', name:'status', align:'center', width:'76', hidden:false, formatter:null });			<%  } %>			<% // 추가컬럼의 출력여부를 확인하여 출력한다			    for(i=4;i<=13;i++){ 			        if(BOARD_LI_ITEM_ARR[i].equals("ETC"+(i-4)) && BOARD_ETC_ITEM_ARR[(i-4)].equals("Y")){			%>			    cols.push({ label:'<%= BOARD_LI_ITEM_NM_ARR[i] %>', name:'data_spa_col<%= i %>', align:'center', width:'10%', hidden:false, formatter:null });			<%			        }			    }			%>						//init grid			var grid = com.grid.init({				 id			: '#jqGrid'				,height		: 364				,rowNum		: 15				,viewrecords: true				,multiSort : true				,ajaxGridOptions: { contentType: "application/json;charset=utf-8" }				,gridComplete: function(){										mergeCellcomplet($(this));				}				,loadComplete: function(data){					// 로드 데이타 갯수 체크					if(searchYn){						isLoadData(data);											}				}						,custom : { //custom					 cols : cols //컬럼정보 - 필수!					,navButton : {						excel : {							exportName	: $('.con_title>h3').text().trim() //엑셀다운로드시 사용할 파일명						}					}				}			});			refreshGrid(); //조회					});				//인력 수정화면 이동		function brdmodify(cellvalue, options, rowObject) {			var url ="";			//if(rowObject.dt_diff < 14){				url = "<a href='#none' onclick=Go_View('"+ rowObject.menu_cd +"','"+ rowObject.data_seqno+"');>" + textToHtml(cellvalue)  + " <img src='<%=img_url%>/cmsadmin/icon_new.gif' alt='new' /></a>";			//}else{			//	url = "" + textToHtml(cellvalue)  + "";			//}			// 현재일자와 등록일자 차이가 14일 이내이면 new이미지를 보여준다					    return url;		}				function brdfile_nms(cellvalue, options, rowObject) { 			var url ="";			var file_split = "";			//alert(cellvalue);			if(cellvalue!="" && cellvalue!="null" && cellvalue!=null){				file_split = cellvalue.split("::");				for(fi=0;fi<file_split.length;fi++){					url = url+file_split[fi].replace(/:/gi,"");					if(fi < file_split.length-1){						url = url+", ";					}				}							}						return url;		}				//조회 : 그리드 조회		function refreshGrid(){			var _frm = document.listfrm;			//_frm.curr_page.value=1;			searchYn = true;			_frm.action='<%=RequestURL%>';			var params = getGridParamDatas();			com.grid.reload('#jqGrid','<c:url value='/cmsajax.do'/>',params);		}				//그리드 조회시 요청할 파라미터 object		function getGridParamDatas(){			var _params = com.frm.getParamJSON(document.listfrm);			_params.pstate = 'X';			return _params;		}						</script>		<div>		    <table id='jqGrid'></table>		</div>		<!-- jqGrid  style="margin: 20px 0px;"//--><div class="fR">      <%-- <%      // 게시판 종류가 통합형, 공지형, 갤러리형이 아닐일경우 등록버튼을 보여준다      if(!BOARD_TY.equals("000025") && !BOARD_TY.equals("000008") && !BOARD_TY.equals("000011")){      %> --%>      <!-- <a Onclick="Go_wrin(); return false;" href="#none"  class="boardBtn">글쓰기</a> --><%-- 	  <%      }	  %>  --%>     </div></form><script type='text/javascript'>$(document).ready(function() {		var mode = '<%=mode %>';	if('main'==mode){		Go_View('<%=pcode%>','<%=ssidx %>');	}		$("#btn_search").click( function() {		if(typeof refreshGrid === 'function'){			refreshGrid(); //grid ajax검색		}else{						su_form=document.listfrm;						if (getLength(su_form.se_text.value) > 50) {				alert("\n검색어는 한글 25자 이상을 입력할수 없습니다.");				su_form.se_text.value = "";				su_form.se_text.focus();  				return false;			}									if (char_chk(su_form.se_text.value,"'") == false) {				alert("\n검색어는 '을 포함할 수 없습니다.");				su_form.se_text.value = "";				su_form.se_text.focus();  				return false;			}			  			  su_form.pstate.value='L';			  su_form.curr_page.value=1;			  su_form.action='<%=RequestURL%>';			  su_form.submit();			  su_form.target = "";		}	});		$("#btn_save").click( function() {		  su_form=document.listfrm;		  su_form.method='post';		  su_form.pstate.value='CF';		  su_form.action='<%=RequestURL%>';		  		  	if(com.tab.isExist()){ //hidden 탭이 존재하면..				var _url = $(document.listfrm).attr('action') + '?' + $(document.listfrm).serialize();				//com.tab.add('CF0','글등록',_url);				com.tab.changeS(_url);			}else{			  su_form.submit();			  su_form.target = "";			}			});	});//<![CDATA[function Go_View(pcode,pidx){	  su_form=document.listfrm;	  su_form.method='post';	  su_form.pcode.value=pcode;	  su_form.sidx.value=pidx;	  su_form.pstate.value='R';	  su_form.action='<%=RequestURL%>';	  	if(com.tab.isExist()){ //hidden 탭이 존재하면..		var _url = $(document.listfrm).attr('action') + '?' + $(document.listfrm).serialize();		//com.tab.add('R'+pidx,'글보기',_url);		com.tab.changeS(_url);	}else{	  su_form.submit();	  su_form.target = "";	}}//글수정처리페이지이동function Go_modin(pidx){  su_form=document.listfrm;  su_form.method='post';  su_form.sidx.value=pidx;  su_form.pstate.value='UF';  su_form.action='<%=RequestURL%>';    	if(com.tab.isExist()){ //hidden 탭이 존재하면..		var _url = $(document.listfrm).attr('action') + '?' + $(document.listfrm).serialize();		//com.tab.add('UF'+pidx,'글수정',_url);		com.tab.changeS(_url);	}else{	  su_form.submit();	  su_form.target = "";	}}//글삭제처리페이지이동function Go_delin(pidx){	  su_form=document.listfrm;  	if(confirm("삭제하시겠습니까?")){		  su_form.target = "successIframe";		  su_form.sidx.value=pidx;		  su_form.pstate.value='D';		  su_form.action='<%=RequestURL%>';		  su_form.submit();		  su_form.target = "";	}else{		return;	}	}// 파일다운로드function GoDownfile(file_seqno){	$.fn.cmfile.fileDownLoad("",file_seqno);}	function sechnotin(){	   var m_Sp = /[$\\@\\\#%\^\&\*\(\)\[\]\+\_\{\}\`\~\=\|\<\>]/;	   var m_val = document.getElementsByName("se_text")[0].value;	   var strLen = m_val.length;	   var m_char = m_val.charAt((strLen) - 1);	   if(m_char.search(m_Sp) != -1) {	      alert("특수문자는 사용할수없습니다.");	      document.getElementsByName("se_text")[0].value = "";	      document.getElementsByName("se_text")[0].focus();	      return;	   }}function srchCheck(){	if(event.keyCode==13){		$("#btn_search").trigger("click");	}}//#####문자체크function char_chk(str,chk){	for(i = 0; i < str.length; i++){		c = str.charAt(i);		if(c == chk){			return false;		}	}}//]]></script>